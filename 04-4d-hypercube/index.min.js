for(h=a.height,w=a.width,vm=(e=>e.map(e=>[e])),mv=(e=>{let i=[e[0][0],e[1][0]];return e.length>2&&i.push(e[2][0]),e.length>3&&i.push(e[3][0]),i}),mmv=((e,i)=>mv(mm(e,vm(i)))),mm=((e,i)=>e.map(e=>tp(i).map(i=>dp(e,i)))),dp=((e,i)=>e.map((m,t)=>e[t]*i[t]).reduce((e,i)=>e+i)),tp=(e=>e[0].map((i,m)=>e.map(e=>e[m]))),dt=((e,i)=>e.reduce((e,m,t)=>e+(m-i[t])**2,0)),P=[],i=16;i--;)P.push([i%2,i%4<2?0:1,i%8<4?0:1,i<8?0:1].map(e=>2*e-1));let e=1,m=1;with(c.translate(w/2,h/2),Math)(L=(()=>{e-=.001,m+=.01,c.strokeStyle=`rgb(${128*sin(2*m)+128},${128*cos(m)+128},${128*sin(m)+128})`;let t=i=>{let t=mmv([[cos(m/4),-sin(m/4)],[sin(m/4),cos(m/4)],[0,0,cos(m),-sin(m)],[0,0,sin(m),cos(m)]],i),c=1/(8-t[3]),s=mmv([[c,0,0],[0,c,0],[0,0,c]],t),a=mmv([[cos(e),0,-sin(e)],[0,1,0],[sin(e),0,cos(e)]],s),l=1/(6-a[2]);return mmv([[l,0],[0,l]],a).map(e=>e*c*3e4)},s=(e,i)=>{c.beginPath();let m=t(P[e]),s=t(P[i]);c.moveTo(m[0],m[1]),c.lineTo(s[0],s[1]),c.stroke()};for(c.fillStyle="rgba(0,0,0,0.1)",c.fillRect(-w/2,-h/2,w,h),c.fillStyle="#fff",c.beginPath(),P.map(e=>{v=t(e),c.moveTo(v[0],v[1]),c.arc(v[0],v[1],5,0,2*PI),c.closePath()}),c.fill(),i=16;i--;)for(j=i;j--;)4==dt(P[i],P[j])&&s(i,j);requestAnimationFrame(L)}))();
