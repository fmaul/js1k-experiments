for(h=a.height,w=a.width,vm=(m=>m.map(m=>[m])),mv=(m=>{let e=[m[0][0],m[1][0]];return m.length>2&&e.push(m[2][0]),m.length>3&&e.push(m[3][0]),e}),mmv=((m,e)=>mv(mm(m,vm(e)))),mm=((m,e)=>m.map(m=>tp(e).map(e=>dp(m,e)))),dp=((m,e)=>m.map((i,t)=>m[t]*e[t]).reduce((m,e)=>m+e)),tp=(m=>m[0].map((e,i)=>m.map(m=>m[i]))),dt=((m,e)=>m.reduce((m,i,t)=>m+(i-e[t])**2,0)),P=[],i=16;i--;)P.push([i%2,i%4<2?0:1,i%8<4?0:1,i<8?0:1].map(m=>2*m-1));let m=1,e=1;with(c.setTransform(1,0,0,1,w/2,h/2),Math)(L=(()=>{m-=.001,e+=.01,c.strokeStyle=`rgb(${128*sin(2*e)+128},${128*cos(e)+128},${128*sin(e)+128})`;let t=i=>{let t=mmv([[cos(e/4),-sin(e/4)],[sin(e/4),cos(e/4)],[0,0,cos(e),-sin(e)],[0,0,sin(e),cos(e)]],i),c=1/(8-t[3]),s=mmv([[c,0,0],[0,c,0],[0,0,c]],t),a=mmv([[cos(m),0,-sin(m)],[0,1,0],[sin(m),0,cos(m)]],s),l=1/(6-a[2]);return mmv([[l,0],[0,l]],a).map(m=>m*c*3e4)},s=(m,e)=>{c.beginPath();let i=t(P[m]),s=t(P[e]);c.moveTo(i[0],i[1]),c.lineTo(s[0],s[1]),c.stroke()};for(c.fillStyle="rgba(0,0,0,0.1)",c.fillRect(-w/2,-h/2,w,h),c.fillStyle="#fff",c.beginPath(),P.map(m=>{v=t(m),c.moveTo(v[0],v[1]),c.arc(v[0],v[1],5,0,2*PI),c.closePath()}),c.fill(),i=16;i--;)for(j=i;j--;)4==dt(P[i],P[j])&&s(i,j);requestAnimationFrame(L)}))();
