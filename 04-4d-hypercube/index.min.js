for(h=a.height,w=a.width,vm=(m=>m.map(m=>[m])),mv=(m=>m.map(m=>m[0])),mmv=((m,i)=>mv(mm(m,vm(i)))),mm=((m,i)=>m.map(m=>tp(i).map(i=>dp(m,i)))),dp=((m,i)=>m.map((a,c)=>m[c]*i[c]).reduce((m,i)=>m+i)),tp=(m=>m[0].map((i,a)=>m.map(m=>m[a]))),dt=((m,i)=>m.reduce((m,a,c)=>m+(a-i[c])**2,0)),P=[],i=16;i--;)P.push([i%2,i%4<2?0:1,i%8<4?0:1,i<8?0:1].map(m=>2*m-1));var m=1,e=1;with(c.translate(w/2,h/2),Math)(L=(()=>{m-=.001,e+=.01,c.strokeStyle=`rgb(${128*sin(2*e)+128},${128*cos(e)+128},${128*sin(e)+128})`;var a=i=>{var a=mmv([[cos(e/4),-sin(e/4)],[sin(e/4),cos(e/4)],[0,0,cos(e),-sin(e)],[0,0,sin(e),cos(e)]],i),c=1/(8-a[3]),t=mmv([[c,0,0],[0,c,0],[0,0,c]],a),s=mmv([[cos(m),0,-sin(m)],[0,1,0],[sin(m),0,cos(m)]],t),v=1/(6-s[2]);return mmv([[v,0],[0,v]],s).map(m=>m*c*3e4)},t=(m,i)=>{c.beginPath();var e=a(P[m]),t=a(P[i]);c.moveTo(e[0],e[1]),c.lineTo(t[0],t[1]),c.stroke()};for(c.fillStyle="rgba(0,0,0,0.1)",c.fillRect(-w/2,-h/2,w,h),c.fillStyle="#fff",c.beginPath(),P.map(m=>{v=a(m),c.moveTo(v[0],v[1]),c.arc(v[0],v[1],5,0,2*PI),c.closePath()}),c.fill(),i=16;i--;)for(j=i;j--;)4==dt(P[i],P[j])&&t(i,j);requestAnimationFrame(L)}))();
